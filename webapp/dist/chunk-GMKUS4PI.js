import{K as d,Qc as h,Rc as y,Sc as A,Tb as g,cc as v,w as u,y as c}from"./chunk-CD5LE2OE.js";import{e as S}from"./chunk-EQDQRRRY.js";var m=S(v());var a=S(v());var j=(()=>{class o{constructor(t){this.authService=t}isGranted(t){return t?this.authService.getRoles().some(i=>t.find(r=>r.role===i)):!1}isScreenAuthorized(t,e){let i=this.authService.getSecurityData();return!(0,a.get)(i,`screens.${t}.${e}.enableSecurity`)||this.isGranted(this.getPolicies(t,e))}isComponentGranted(t,e,i,r="view"){let s=this.authService.getSecurityData();return!(0,a.get)(s,`screens.${t}.${e}.components.${i}.enableSecurity`)||this.isGranted(this.getPolicies(t,e,i,r))}getPolicies(t,e,i,r){let s=null,n=this.authService.getSecurityData();return i?s=(0,a.get)(n,`screens.${t}.${e}.components.${i}.roles.${r}`):s=(0,a.get)(n,`screens.${t}.${e}.roles`),s?s.map(l=>({role:l})):[]}keysExtractor(t){let e=t.split(",");return{feature:e[0],screen:e[1],component:e[2]}}static{this.\u0275fac=function(e){return new(e||o)(c(h))}}static{this.\u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var U=(()=>{class o{constructor(t,e,i,r,s,n){this.router=t,this.injector=e,this.message=i,this.authService=r,this.policyService=s,this.menuService=n}canActivate(t,e){return this.checkAuthorization(t,e)}canActivateChild(t,e){return this.checkAuthorization(t,e)}checkAuthorization(t,e){let i=this.menuService.getUnfiltredMenu()||[],r=this.menuService.getFiltredMenu(),s=e.url,n=this.menuIncludesUrl(i,s),l=this.isMenuAuthorized(s,r),f=this.isScreenAuthorized(t,this.authService.isLogged()),p=n?l&&f:f;if(!p){let I=e.url;this.authService.doLogout(I)}return p}isScreenAuthorized(t,e){try{let i=t._urlSegment.segments,r=(0,m.kebabCase)(isNaN(i[0].path)?i[0].path:i[1].path),s=(0,m.kebabCase)(isNaN(i[0].path)?i[1].path:i[2].path);r&&e&&(this.policyService.isScreenAuthorized(r,s)||(this.message.openErrorMessage($localize`:message;notAllowedToOpenScreen:You are not allowed to open this screen`),this.router.navigate(["/"]),e=!1))}catch{}return e}isMenuAuthorized(t,e){return e&&t!="/"?Array.isArray(e)?this.menuIncludesUrl(e,t):!1:!0}menuIncludesUrl(t,e){let i=/^\/\d+\/(?=\D)/,r=e.match(i),s=r?e.slice(r[0].length-1):e;for(let n of t){if(n.link&&n.link[0]!=="/"&&s.startsWith(n.link[0]))return!0;if(n.items)return this.menuIncludesUrl(n.items,s)}return!1}static{this.\u0275fac=function(e){return new(e||o)(c(g),c(d),c(y),c(h),c(j),c(A))}}static{this.\u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{U as a};
